[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.952827",
  "module": "Am Health",
  "name": "Patient",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Patient",
  "script": "if not (doc.mobile and len(doc.mobile) == 10 and doc.mobile.isdigit() and doc.mobile[0] in \"6789\"):\n    frappe.throw(\"Please Enter a valid Mobile Number\")\nif not (doc.custom_reference_number and doc.custom_reference_number.isdigit() and len(doc.custom_reference_number) == 4):\n    frappe.throw(\"Reference Number must be exactly 4 digits.\")\n\nblock_name = frappe.db.get_value(\"Block\", doc.custom_block, \"block_name\")\ndoc.custom_patient_id = f\"{block_name.upper()[:2]}-{doc.custom_village_short_code}-{frappe.utils.format_date(doc.dob, 'dd-mm-yyyy')}-{doc.custom_reference_number}\"\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:53.014644",
  "module": "Am Health",
  "name": "User",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "User",
  "script": "roles = [i.role for i in doc.roles]\nif roles and \"System Manager\" not in roles:\n    role = sorted(roles)[0]\n    hp_name = frappe.db.get_value(\"Healthcare Practitioner\", {\"user_id\": doc.name}, 'name')\n    if hp_name:\n        hp_doc = frappe.get_doc(\"Healthcare Practitioner\", hp_name)\n    else:\n        hp_doc = frappe.new_doc(\"Healthcare Practitioner\")\n        hp_doc.user_id = doc.name\n        hp_doc.first_name = doc.first_name\n        hp_doc.last_name = doc.last_name\n        hp_doc.gender = doc.gender\n        hp_doc.status = \"Active\"\n    hp_doc.custom_type = role\n    hp_doc.save(ignore_permissions=True)",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.959875",
  "module": "Am Health",
  "name": "User Before Save",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "User",
  "script": "roles = [i.role for i in doc.roles]\nif roles and \"System Manager\" not in roles:\n    if not doc.custom_district:\n        frappe.throw(\"Please Enter District\")\nif \"Doctor\" in roles and \"Physician\" not in roles:\n    \n    doc.append(\"roles\", {\n        \"role\": \"Physician\"\n    })\n    \n    ",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.886994",
  "module": "Am Health",
  "name": "Patient Registration",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Patient Encounter",
  "script": "doc.custom_patient_registration = frappe.db.get_value(\"Vital Signs\", {\"patient\": doc.patient, \"signs_date\": doc.encounter_date}, 'name')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 1,
  "api_method": "make_patient_registration",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.915019",
  "module": "Am Health",
  "name": "Vitals Mapped Doc",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "frappe.model.mapper.get_mapped_doc(\n\t\"Journal Entry\",\n\tsource_name,\n\t{\n\t\t\"Journal Entry\": {\"doctype\": \"Journal Entry\", \"validation\": {\"docstatus\": [\"=\", 1]}},\n\t\t\"Journal Entry Account\": {\n\t\t\t\"doctype\": \"Journal Entry Account\",\n\t\t\t\"field_map\": {\n\t\t\t\t\"account_currency\": \"account_currency\",\n\t\t\t\t\"exchange_rate\": \"exchange_rate\",\n\t\t\t\t\"debit_in_account_currency\": \"credit_in_account_currency\",\n\t\t\t\t\"debit\": \"credit\",\n\t\t\t\t\"credit_in_account_currency\": \"debit_in_account_currency\",\n\t\t\t\t\"credit\": \"debit\",\n\t\t\t\t\"reference_type\": \"reference_type\",\n\t\t\t\t\"reference_name\": \"reference_name\",\n\t\t\t},\n\t\t},\n\t},\n\ttarget_doc,\n\tpost_process,\n)\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.987795",
  "module": "Am Health",
  "name": "Patient Query",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Patient",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    village = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"custom_district = '{village}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:53.009145",
  "module": "Am Health",
  "name": "Village",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Village",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    custom_district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabVillage`.district = '{custom_district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.993194",
  "module": "Am Health",
  "name": "State",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "State",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    state = frappe.db.get_value(\"District\", district, 'state')\n    conditions = f\"`tabState`.name = '{state}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.982636",
  "module": "Am Health",
  "name": "District",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "District",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabDistrict`.name = '{district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.998661",
  "module": "Am Health",
  "name": "Block",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Block",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabBlock`.district = '{district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:53.003789",
  "module": "Am Health",
  "name": "Gram Panchayat",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Gram Panchayat",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabGram Panchayat`.district = '{district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.977168",
  "module": "Am Health",
  "name": "Patient Registration Query",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vital Signs",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabVital Signs`.custom_district = '{district}' and `tabVital Signs`.encounter IS NULL\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.971371",
  "module": "Am Health",
  "name": "Doctor Consultation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Patient Encounter",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabPatient Encounter`.custom_district = '{district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.965550",
  "module": "Am Health",
  "name": "Medicine Prescription Form",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Medicine Prescription Form",
  "script": "user_doc = frappe.get_doc('User', frappe.user)\nroles = {r.role for r in user_doc.roles}  \n\nif frappe.session.user != \"Administrator\":\n    district = frappe.db.get_value(\"User\", frappe.session.user, 'custom_district')\n    conditions = f\"`tabMedicine Prescription Form`.district = '{district}'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.939016",
  "module": "Am Health",
  "name": "Patient Encounter",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Patient Encounter",
  "script": "mp_name = frappe.db.get_value(\"Medicine Prescription Form\", {'patient_encounter': doc.name})\nif mp_name:\n    mp_doc = frappe.get_doc(\"Medicine Prescription Form\", mp_name)\nelse:\n    mp_doc = frappe.new_doc(\"Medicine Prescription Form\")\n\nmp_doc.patient = doc.patient\nmp_doc.patient_encounter = doc.name\nmp_doc.patient_registration = doc.custom_patient_registration\nmp_doc.flags.ignore_mandatory = True\nmp_doc.save(ignore_permissions=True)\n\nif doc.custom_patient_registration:\n    pr_doc = frappe.get_doc(\"Vital Signs\", doc.custom_patient_registration)\n    pr_doc.custom_is_consulted = \"Yes\"\n    pr_doc.save(ignore_permissions=True)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 1,
  "api_method": "patients_pending",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.929562",
  "module": "Am Health",
  "name": "Patients Pending NC",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "filters = [\n    [\"encounter\", \"is\", \"not set\"],\n    [\"custom_is_consulted\", \"=\", 0]\n]\n\nfrappe.response['message'] = {\n\t\"value\": frappe.db.count(\"Vital Signs\", filters),\n\t\"fieldtype\": \"Int\",\n\t\"route_options\": {\n\t    \"encounter\": [\"is\", \"not set\"],\n\t    \"custom_is_consulted\": [\"=\", 0]\n\t},\n\t\"route\": [\"list\", \"Vital Signs\"]\n}\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-24 16:27:52.947635",
  "module": "Am Health",
  "name": "Vital Signs",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Vital Signs",
  "script": "if doc.patient:\n    p_doc = frappe.db.get_value(\"Patient\", doc.patient)\n    doc.custom_age = p_doc.age_html",
  "script_type": "DocType Event"
 }
]